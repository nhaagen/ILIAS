/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t){"use strict";class e{#t;#e;#i;#n;constructor(t,e){this.#t=t,this.#e=e,this.#i=[],this.#n=[]}getLabel(){return this.#t}getType(){return this.#e}addChildNode(t){this.#i.push(t)}getChildren(){return this.#i}addHtmlField(t){this.#n.push(t)}getHtmlFields(){return this.#n}getValues(){const t=[];return this.#n.forEach((e=>{"checkbox"===e.type||"radio"===e.type?e.checked&&t.push(e.value):t.push(e.value)})),t}getFilteredChildren(){if("SwitchableGroupFieldInput"===this.getType()){const t=[],e=this.getChildren();return this.getHtmlFields().forEach(((i,n)=>{i.checked&&t.push(e[n])})),t}return"OptionalGroupFieldInput"!==this.getType()||this.getHtmlFields()[0].checked?this.getChildren():[]}}const i="[data-il-ui-type]";class n{#r;#l;constructor(t){this.#r=t,this.#l=new e("form","FormContainerInput");Array.from(t.querySelectorAll(i)).filter((t=>!t.parentNode.closest(i))).forEach((t=>this.#s(t,this.#l)))}#s(t,i){const n=this.#a(t),r=new e(n,t.getAttribute("data-il-ui-type"));this.#o(t).forEach((t=>r.addHtmlField(t)));this.#d(t).forEach((t=>this.#s(t,r))),i.addChildNode(r)}#d(t){return Array.from(t.querySelectorAll(i)).filter((e=>e.parentNode.closest(i)===t))}#o(t){return Array.from(t.querySelectorAll("[name]")).filter((e=>e.parentNode.closest(i)===t))}#a(t){let e="";const n=Array.from(t.querySelectorAll("label")).filter((e=>e.parentNode.closest(i)===t));return n.length>0&&(e=n[0].textContent),e}getNodes(){return this.#l}getAllNodesFlat(t,e){let i=e,n=t;i||(i=[],n=this.#l),i.push({label:n.getLabel(),values:n.getValues(),valuesRepresentation:this.#p(n),type:n.getType()});const r=n.getFilteredChildren();return r.length>0&&r.forEach((t=>this.getAllNodesFlat(t,i))),i}getAllNodesStruct(t){let e=t;e||(e=this.#l);const i={label:e.getLabel(),values:e.getValues(),valuesRepresentation:this.#p(e),type:e.getType(),fields:e.getHtmlFields(),children:[]},n=e.getFilteredChildren();return n.length>0&&n.forEach((t=>i.children.push(this.getAllNodesStruct(t)))),i}#p(t){return this.tempInit(),this.presentation[t.getType()]?this.presentation[t.getType()](t):t.getValues()}presentation=[];tempInit(){this.presentation.PasswordFieldInput=()=>null,this.presentation.SwitchableGroupFieldInput=function(t){const e=t.getFilteredChildren();if(0===e.length)return[];const i=[];return e.forEach((t=>i.push(t.getLabel()))),i},this.presentation.RadioFieldInput=function(t){const e=t.getHtmlFields().filter((t=>t.checked));if(0===e.length)return[];const i=[];return e.forEach((t=>i.push(t.parentNode.querySelector("label").textContent))),i},this.presentation.MultiSelectFieldInput=this.presentation.RadioFieldInput,this.presentation.DurationFieldInput=function(t){const[e,i]=t.getChildren().map((t=>t.getValues()[0]));return e&&i?`${e} - ${i}`:"-"},this.presentation.LinkFieldInput=function(t){const[e,i]=t.getChildren().map((t=>t.getValues()[0]));return`${e} [${i}]`},this.presentation.SelectFieldInput=function(t){const e=t.getHtmlFields()[0];return e.options[e.options.selectedIndex].text}}}il=il||{},il.UI=il.UI||{},il.UI.filter=function(t){t((function(){t("div.il-filter").each((function(){var i=this,n=0,l=1;t(i).find(".il-standard-form").attr("action",window.location.pathname),t(i).find(".il-filter-field-status").each((function(){$hidden_input=this,"0"===t($hidden_input).val()?t(t("div.il-filter .il-popover-container")[n]).hide():t(t("div.il-filter .il-filter-add-list li")[n]).hide(),n++})),t(".il-filter-bar-opener").find("button:first").hide(),t(".il-filter-bar-opener button").click((function(){t(".il-filter-bar-opener button").toggle(),"false"==t(this).attr("aria-expanded")?t(this).attr("aria-expanded","true"):t(this).attr("aria-expanded","false")}));var s=!1;t(i).find(".il-popover-container").each((function(){var i=t(this).find(":input:not(:button)"),n=i.val(),r=t(this).find(".leftaddon").text(),a=e(i,n);""!==a?(t(".il-filter-inputs-active").find("span[id='"+l+"']").html(r+": "+a),s=!0):t(".il-filter-inputs-active").find("span[id='"+l+"']").hide(),l++})),s||t(".il-filter-inputs-active").hide(),t(".input-group .btn.btn-bulky").attr("data-placement","bottom");var a=!0;t(i).find(".il-filter-add-list").find("li").each((function(){"none"!==t(this).css("display")&&"hidden"!==t(this).css("visibility")&&(a=!1)})),a&&t(".btn-bulky").parents(".il-popover-container").hide(),t(".il-filter-field").keydown((function(e){var i=e.which;if(13===i||32===i){t(this).click();var n=r(t(this));0!=n.length&&n[0].focus(),e.preventDefault()}}))}))}));var e=function(e,i){var n="";if(e.is(":checkbox")){var r=[];e.each((function(){t(this).prop("checked")&&r.push(t(this).parent().find("span").text())})),0!=r.length&&(active_checkboxes=r.join(", "),n=active_checkboxes)}else if(e.is("select")&&""!==i){n=e.find("option:selected").text()}else void 0!==i&&""!==i&&(n=i);return n},i=function(e,i,n){t(e.parents(".il-filter").find(".il-filter-field-status").get(i)).val(n)},n=function(t){return t.parents(".il-popover-container").find(":input")},r=function(t){return t.parents(".il-popover-container").find(".il-standard-popover-content").children().children().find("input")},l=function(t){return t.parents(".il-standard-form").find(".btn-bulky").parents(".il-popover-container")};return{onInputUpdate:function(e,i){let n;var r=t(i.triggerer[0]).parents(".il-popover").attr("id");n=r?document.querySelector("span[data-target='"+r+"']"):i.triggerer[0].closest(".input-group").querySelector("span.il-filter-field"),n&&(n.innerText=i.options.string_value)},onRemoveClick:function(e,s){var a=t("#"+s),o=a.parents(".il-popover-container").index();i(a,o,"0"),a.parents(".il-popover-container").hide(),n(a).val("");var d=r(a);d.each((function(){t(this).prop("checked",!1)})),d.parents(".il-popover-container").find(".il-filter-field").html("");var p=a.parents(".input-group").find(".input-group-addon.leftaddon").html(),u=function(e,i){return e.parents(".il-standard-form").find(".btn-link").filter((function(){return t(this).text()===i})).parents("li")}(a,p);u.show();var c=l(a);0!=a.parents(".il-standard-form").find(".il-popover-container:hidden").length&&c.show()},onAddClick:function(e,s){var a=t("#"+s),o=a.text();a.parent().hide();var d=a.parent().index();i(a,d,"1");var p=function(e,i){return e.parents(".il-standard-form").find(".input-group-addon.leftaddon").filter((function(){return t(this).text()===i}))}(a,o);p.parents(".il-popover-container").show(),n(p).focus(),p.parent().find(".il-filter-field").click();var u=r(p);0!=u.length&&u[0].focus();var c=l(a);0===a.parents(".il-filter").find(".il-filter-add-list").find("li:visible").length&&c.hide(),c.find(".il-popover").hide()},onCmd:function(e,i,n){var r=t("#"+i),l=function(t){var e=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(t),n={},r=14;for(;r--;)i[r]&&(n[e[r]]=i[r]);var l=/(?:^|&)([^&=]*)=?([^&]*)/g;return n.query_params={},(n[e[12]]||"").replace(l,(function(t,e,i){e&&(n.query_params[e]=i)})),delete n.source,n}(r.parents("form").attr("data-cmd-"+n));!function(t,e){for(var i in e){var n='<input type="hidden" name="'+i+'" value="'+e[i]+'">';t.parents("form").find(".il-filter-bar").before(n)}}(r,l.query_params),r.parents("form").attr("action",l.path),r.parents("form").submit()},onAjaxCmd:function(e,i,n){var r=t("#"+i),l=r.parents("form").attr("data-cmd-"+n),s=r.parents("form").serialize();t.ajax({type:"GET",url:l+"&"+s})}}}(t),il.UI.Input=il.UI.Input||{},il.UI.Input.Container=new class{#u=[];init(t){const e=`#${t}`,i=document.querySelector(e);if(void 0!==this.#u[t])throw new Error(`Container with id '${t}' has already been registered.`);this.#u[t]=new n(i)}get(t){return this.#u[t]}getAll(){return this.#u}first(){return this.#u[Object.keys(this.#u).shift()]}}}($);
